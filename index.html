<html>
  <head>
    <link rel="stylesheet" href="index.css">
  </head>
  <body>
    <h1>A Pokemon Capture Game</h1>

    <div id="name"></div>
    <div id="sprite"></div>
    <div id="hp">hit point: </div>
    <div class="button-container">
      <button class="button" onClick="newPokemon()">Find New Pokemon!</button>
      <button class="button" onClick="hit()">Hit with a stick</button>
      <button class="button" onClick="catchPokemon()">Catch Pokemon</button>
    </div>

    <h6>Action History</h6>
    <div id="actions"></div>

    <h6>Your Pokemon</h6>
    <div id="yourPokemon"></div>
    <div id="yourPokemonNickName"></div>

    <script>
      let pokemon = {};
      let yourPokemon = {};
      let yourActions = [];

      const hit = () => {
        pokemon.hp = pokemon.hp - Math.floor(Math.random() * 50)
        document.getElementById("hp").innerHTML = `<h3>HP:  + ${pokemon.hp}`
        hitActions(pokemon.hp)
        drawActions();
      }

      const drawYourPokemon = () => {
        let html = "<table>"
        for  (const property in yourPokemon) {
          html +="<tr>";
          html +="<td>" + property + "</td>"
          html +="<td>" + `<img src="${yourPokemon[property]}"` + "</td>"
          html +="</tr>"
        }
        html += "</table>";
        document.getElementById("yourPokemon").innerHTML = html;
      }

      const hitActions = (hp) => {
        yourActions.push(hp);
      }

      const catchActions = (message) => {
        yourActions.push(message);
        drawActions();
      }

      const drawActions = () => {
        let actionsHtml = ""
        for(var i = 0; i < yourActions.length; i++) {
          actionsHtml += `<p>${yourActions[i]}<p>`
        }
        document.getElementById("actions").innerHTML = actionsHtml;
      }

      const catchPokemon = () => {
        let chanceToCatch = pokemon.hp / pokemon.base_hp;
        Math.random()
        if(Math.random() > chanceToCatch) {
          let newName = prompt("Please give your Pokemon a nickname")
          yourPokemon[newName]  = pokemon.sprite;
          console.log("yourPokemon object is ", yourPokemon)
          //yourPokemon.push(pokemon.sprite);
          newPokemon();
          drawYourPokemon();
          catchActions("Caught Pokemon!!!");
          console.log("pokemon caught")
        } 
        else {
          console.log("failed to catch pokemon")
          catchActions("Darnit! Pokemon got away!");
        }
      }

      async function newPokemon() {
        let num = Math.floor(Math.random() * 500)
        fetch(`https://pokeapi.co/api/v2/pokemon/${num}`)
          .then(response => response.json())
          .then(data => {
            pokemon.name = data.name
            pokemon.sprite = data.sprites.front_default
            pokemon.hp = data.stats[0].base_stat
            pokemon.base_hp = data.stats[0].base_stat
            document.getElementById("name").innerHTML = pokemon.name
            document.getElementById("sprite").innerHTML = `<img src="${pokemon.sprite}">`
          })
      }
      newPokemon();
    </script>
  </body>
</html>